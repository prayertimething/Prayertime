<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times</title>
    <style>
/* General Styling */
:root {
    --primary-color: #4e73df;
    --secondary-color: #1e3c72;
    --highlight-color: #ffcc00;
    --background-color: #eef2f3;
    --text-color: #333;
    --button-color: #4e73df;
    --button-hover-color: #3498db;
    --error-color: #ff4d4d;
}

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: var(--background-color);
}

/* Container for layout */
.container {
    display: flex;
    width: 90%;
    max-width: 1000px;
    background: white;
    border: 2px solid #ccc;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    overflow: hidden;
    flex-wrap: wrap; /* Allow responsiveness */
}

/* Prayer times section */
.prayer-times {
    flex: 1 1 50%; /* Makes it responsive */
    padding: 1.5rem;
    background: var(--primary-color);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.prayer-time {
    font-size: 1rem;
    margin: 1rem 0;
}

.prayer-time.active {
    font-size: 1.25rem;
    font-weight: bold;
    color: var(--highlight-color);
}

/* Hadith section */
.hadith {
    flex: 1 1 50%; /* Makes it responsive */
    padding: 1.5rem;
    background: var(--secondary-color);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

/* Timer */
#timer {
    font-size: 1.25rem;
    color: var(--text-color);
    margin-top: 1rem;
}

/* Popup Styling */
.popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    padding: 1rem;
    background: white;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    text-align: center;
    z-index: 9999;
}

.popup h2 {
    font-size: 1.125rem;
    margin-bottom: 1rem;
}

.popup button {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    margin: 0.5rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.popup button#yes-btn {
    background: var(--primary-color);
    color: white;
}

.popup button#no-btn {
    background: var(--error-color);
    color: white;
}

.popup button:hover {
    background-color: var(--button-hover-color);
}

/* Background overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
}

/* Buttons styling (General) */
button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    margin-top: 1rem;
    border: none;
    background-color: var(--primary-color);
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: var(--button-hover-color);
}

/* Responsive Design for smaller screens */
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }

    .prayer-times, .hadith {
        flex: 1 1 100%;
        padding: 1rem;
    }
}

    </style>
</head>
<body>
    <div class="container">
        <!-- Prayer Times Section -->
        <div class="prayer-times" id="prayer-times">
            <h3>Prayer Times</h3>
            <div id="fajr" class="prayer-time"></div>
            <div id="dhuhr" class="prayer-time"></div>
            <div id="asr" class="prayer-time"></div>
            <div id="maghrib" class="prayer-time"></div>
            <div id="isha" class="prayer-time"></div>
        </div>

        <!-- Hadith Section -->
        <div class="hadith" id="hadith">
            <h3>Hadith of the Minute</h3>
            <p id="hadith-text">“The best among you are those who have the best manners and character.” – Prophet Muhammad (PBUH)</p>
        </div>
    </div>

    <div id="timer">Time until next prayer: <span id="countdown">--:--:--</span></div>
    <p>For now, consider <b>not</b> to accept the notification requests. These are still in testing <i>(and didn't go well)</i>. To add, apologies for the hadiths recently missing/undefined. It has been fixed.</p>
    <button onclick="OpenJuz30()">Al Qur'an</button>
    <button onclick="Qibla()">Qibla Finder (Innacurate)</button>
    <button onclick="HijriDate()">Hijri (Broken events)</button>
    <button onclick="Count()">Tasbeeh Counter</button>

    <!-- Location Popup -->
    <div id="location-popup" class="popup" style="display: none;">
        <h2>Allow Location Access?</h2>
        <p>We need your location to display accurate prayer times.</p>
        <button id="yes-btn">Yes</button>
        <button id="no-btn">No</button>
    </div>

    <!-- Background Overlay -->
    <div id="overlay" class="overlay" style="display: none;"></div>

    <!-- Audio for Adhan -->
    <audio id="adhan-audio" src="https://path/to/adhan.mp3" preload="auto"></audio>

    
<script>
const hadiths = [
  "Actions are judged by intentions — Sahih al-Bukhari",
  "None of you truly believes until he loves for his brother what he loves for himself — Sahih al-Bukhari",
  "The best among you are those who have the best manners and character — Sahih al-Bukhari",
  "Speak good or remain silent — Sahih al-Bukhari & Sahih Muslim",
  "The strong person is the one who controls himself when angry — Sahih al-Bukhari",
  "Modesty brings nothing but good — Sahih Muslim",
  "Cleanliness is half of faith — Sahih Muslim",
  "Feed the hungry and visit the sick — Sahih al-Bukhari",
  "The most beloved deeds to Allah are those done regularly, even if small — Sahih al-Bukhari",
  "Do not waste water even if you are at a flowing river — Ibn Majah",
  "Make things easy and do not make them difficult — Sahih al-Bukhari",
  "Do not become angry — Sahih al-Bukhari",
  "A believer is not one who eats his fill while his neighbor is hungry — Al-Adab al-Mufrad",
  "The upper hand is better than the lower hand — Sahih al-Bukhari",
  "He who does not show mercy will not receive mercy — Sahih Muslim",
  "The best of you are those who learn the Qur’an and teach it — Sahih al-Bukhari",
  "The best jihad is to speak a word of truth before a tyrant ruler — Sunan Abu Dawud",
  "Whoever believes in Allah and the Last Day should honor his guest — Sahih al-Bukhari",
  "Exchange gifts and you will love one another — Al-Adab al-Mufrad",
  "Do not harm yourself or others — Ibn Majah",
  "Allah does not look at your forms or wealth, but at your hearts and deeds — Sahih Muslim",
  "A kind word is charity — Sahih al-Bukhari",
  "The most complete believer is he with the best character — Sunan Tirmidhi",
  "Do not envy one another — Sahih Muslim",
  "The most beloved people to Allah are those who bring the most benefit to others — Al-Mu'jam al-Awsat",
  "Whoever does not thank people has not thanked Allah — Sunan Abu Dawud",
  "The one who guides to good is like the one who does it — Sahih Muslim",
  "Charity does not decrease wealth — Sahih Muslim",
  "Do not backbite one another — Sahih Muslim",
  "Truth leads to righteousness and righteousness leads to Paradise — Sahih al-Bukhari",
  "Lying leads to wickedness and wickedness leads to Hell — Sahih al-Bukhari",
  "Do not oppress and do not be oppressed — Sahih Muslim",
  "The best among you are those who are best to their families — Sunan Ibn Majah",
  "Prayer is light — Sahih Muslim",
  "The believer’s shade on the Day of Judgment will be his charity — Sunan Tirmidhi",
  "The best prayer after obligatory prayers is at night — Sahih Muslim",
  "The best wealth is contentment of the heart — Sahih al-Bukhari",
  "Do not waste wealth — Sahih al-Bukhari",
  "Purity is half of faith — Sahih Muslim",
  "The one who repents from sin is like one who never sinned — Sunan Ibn Majah",
  "Riches are not from abundance of possessions but from contentment — Sahih al-Bukhari",
  "Visit the sick and feed the hungry — Sahih al-Bukhari",
  "Help your brother whether he is an oppressor or oppressed — Sahih al-Bukhari",
  "Do not delay in doing good — Sahih Muslim",
  "He who cheats is not one of us — Sahih Muslim",
  "He who is not thankful for small things will not be thankful for large things — Musnad Ahmad",
  "The best of you are those whose manners are best — Sahih al-Bukhari",
  "The one who walks to seek knowledge, Allah will make his path to Paradise easy — Sahih Muslim",
  "He who does not show mercy to our young nor respect our elders is not one of us — Sunan Tirmidhi",
  "Allah is gentle and loves gentleness — Sahih Muslim",
  "The most truthful speech is the Book of Allah — Sahih Muslim",
  "A man’s true wealth is the good he does in this world — Sahih Muslim",
  "The best of you are those who feed others — Musnad Ahmad",
  "The one who keeps ties of kinship will have his lifespan increased — Sahih al-Bukhari",
  "The most beloved words to Allah are SubhanAllah, Alhamdulillah, La ilaha illallah, Allahu Akbar — Sahih Muslim",
  "He who deceives is not of us — Sahih Muslim",
  "The best charity is that given in secret — Sunan Ibn Majah",
  "Be kind, for kindness is a mark of faith — Sahih Muslim",
  "Every innovation in religion is misguidance — Sunan Abu Dawud",
  "Do not look to those above you, look to those below you — Sahih Muslim",
  "The believer is friendly and befriended — Musnad Ahmad",
  "The strong is not the one who defeats others, but the one who controls himself — Sahih Muslim",
  "The best companion is the one who is best to his companion — Sunan Tirmidhi",
  "The best among you are those who are best to their parents — Sahih Muslim",
  "The most beloved actions to Allah are those done consistently — Sahih al-Bukhari",
  "Allah is not merciful to him who is not merciful to others — Sahih al-Bukhari",
  "The one who helps in righteousness will share in the reward — Sahih Muslim",
  "The best of you are those who learn and teach the Qur’an — Sahih al-Bukhari",
  "The most beloved deed to Allah is prayer on time — Sahih al-Bukhari",
  "The believer mirrors his brother — Sunan Abu Dawud",
  "Do not hate one another, and do not turn away from each other — Sahih Muslim",
  "The world is sweet and green, and Allah will test you in it — Sahih Muslim",
  "When a man dies, his deeds come to an end except three: charity, knowledge, and righteous child — Sahih Muslim",
  "He who does not thank people has not thanked Allah — Sunan Abu Dawud",
  "Visit graves, for they remind you of death — Sahih Muslim",
  "The best among you are those who are best to their servants — Sahih Muslim",
  "Fear Allah wherever you are — Sunan Tirmidhi",
  "Follow a bad deed with a good one and it will erase it — Sunan Tirmidhi",
  "Meet people with a cheerful face — Sunan Tirmidhi",
  "Give charity without delay, for it stands in the way of calamity — Al-Adab al-Mufrad",
  "The most perfect of believers are those with the best manners — Sunan Abu Dawud",
  "A Muslim is one from whose tongue and hand others are safe — Sahih al-Bukhari",
  "A believer’s faith is complete when he loves for his brother what he loves for himself — Sahih al-Bukhari",
  "He who believes in Allah and the Last Day should not harm his neighbor — Sahih al-Bukhari",
  "The best of you are those who are best in paying debts — Sahih al-Bukhari",
  "The most beloved of people to Allah are the most beneficial to people — Al-Mu'jam al-Kabir",
  "He who removes a worldly hardship from a believer will have a hardship removed in the Hereafter — Sahih Muslim",
  "Whoever covers a Muslim’s faults, Allah will cover his faults on the Day of Judgment — Sahih Muslim",
  "The best of you are those who feed others and return greetings — Musnad Ahmad",
  "The best among you are those who are best to their companions — Sunan Tirmidhi",
  "Whoever is deprived of gentleness is deprived of all good — Sahih Muslim",
  "He who believes in Allah and the Last Day should speak good or remain silent — Sahih al-Bukhari",
  "Charity extinguishes sin as water extinguishes fire — Sunan Tirmidhi",
  "Love for people what you love for yourself — Sahih Muslim",
  "Do not harm animals — Sahih al-Bukhari",
  "The best of you are those who are best to their wives — Sunan Tirmidhi",
  "The one who makes peace between people will be rewarded — Sunan Abu Dawud",
  "Beware of suspicion, for suspicion is the worst of false tales — Sahih al-Bukhari",
  "Do not wish for death — Sahih al-Bukhari",
  "The best among you are those who have the best manners — Sahih al-Bukhari"
];

let currentHadithIndex = 0;
let prayerTimes = {};

function updateHadith() {
    const hadithText = document.getElementById('hadith-text');
    hadithText.innerText = hadiths[currentHadithIndex];
    currentHadithIndex = (currentHadithIndex + 1) % hadiths.length;
}

function fetchPrayerTimes(city, country) {
    const url = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=2`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            const timings = data.data.timings;
            prayerTimes = {
                Fajr: timings.Fajr,
                Dhuhr: timings.Dhuhr,
                Asr: timings.Asr,
                Maghrib: timings.Maghrib,
                Isha: timings.Isha
            };
            updatePrayerTimesDisplay();
            startTimer();
            scheduleNotifications(prayerTimes);
        })
        .catch(() => alert('❌ Error fetching prayer times. Check city/country values.'));
}

function updatePrayerTimesDisplay() {
    document.getElementById('fajr').innerText = `Fajr: ${prayerTimes.Fajr}`;
    document.getElementById('dhuhr').innerText = `Dhuhr: ${prayerTimes.Dhuhr}`;
    document.getElementById('asr').innerText = `Asr: ${prayerTimes.Asr}`;
    document.getElementById('maghrib').innerText = `Maghrib: ${prayerTimes.Maghrib}`;
    document.getElementById('isha').innerText = `Isha: ${prayerTimes.Isha}`;
}

function getNextPrayerTime() {
    const now = new Date();
    for (let [name, time] of Object.entries(prayerTimes)) {
        const prayerDateTime = new Date();
        const [hour, minute] = time.split(':');
        prayerDateTime.setHours(parseInt(hour), parseInt(minute), 0);

        if (prayerDateTime > now) {
            return { name, time: prayerDateTime };
        }
    }
    return null;
}

function startTimer() {
    const countdownElement = document.getElementById('countdown');

    function updateCountdown() {
        const nextPrayer = getNextPrayerTime();
        if (nextPrayer) {
            const now = new Date();
            const diff = nextPrayer.time - now;

            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            countdownElement.innerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
    }

    updateCountdown(); // Call immediately
    setInterval(updateCountdown, 1000);
}

function showPrayerAlert(prayer) {
    const alertBox = document.getElementById('alert-box');
    if (alertBox) {
        alertBox.innerText = `It is time for ${prayer}!`;
        alertBox.style.display = 'block';
        document.getElementById('adhan-audio').play();
        setTimeout(() => alertBox.style.display = 'none', 60000);
    } else {
        alert(`It is time for ${prayer}!`);
        document.getElementById('adhan-audio').play();
    }
}

function scheduleNotifications(prayerTimes) {
    const now = new Date();
    Object.entries(prayerTimes).forEach(([prayer, time]) => {
        const [hours, minutes] = time.split(':').map(Number);
        const prayerTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);

        if (prayerTime < now) {
            prayerTime.setDate(prayerTime.getDate() + 1);
        }

        const timeUntilPrayer = prayerTime - now;
        setTimeout(() => {
            if (Notification.permission === "granted") {
                showNotification(prayer);
            } else {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") showNotification(prayer);
                    else alert(`Time for ${prayer} prayer.`);
                });
            }
        }, timeUntilPrayer);
    });
}

function showNotification(prayer) {
    const notification = new Notification(`${prayer} Prayer Time`, {
        body: `It's time for ${prayer} prayer.`,
    });
    document.getElementById('adhan-audio').play();
}

function askForLocation() {
    const popup = document.getElementById('location-popup');
    const overlay = document.getElementById('overlay');

    popup.style.display = 'block';
    overlay.style.display = 'block';

    document.getElementById('yes-btn').onclick = function () {
        popup.style.display = 'none';
        overlay.style.display = 'none';
        getUserLocation();
    };

    document.getElementById('no-btn').onclick = function () {
        popup.style.display = 'none';
        overlay.style.display = 'none';
        alert('Cannot determine prayer times without location.');
    };
}

function getUserLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
                .then(res => res.json())
                .then(data => {
                    const city = data.city || data.locality || 'Cairo';
                    const country = data.countryName || 'Egypt';
                    fetchPrayerTimes(city, country);
                })
                .catch(() => alert('Could not get location details.'));
        }, () => {
            alert('Location access denied. Enable location in your browser.');
        });
    } else {
        alert('Geolocation not supported on your device.');
    }
}

// INIT
askForLocation();
setInterval(updateHadith, 60000); // Rotate hadiths every minute

function OpenJuz30() { location.href = "juz30.html"; }
function Qibla() { location.href = "qibla.html"; }
function Count() { location.href = "counter.html"; }
function HijriDate() { location.href = "hijri.html"; }

</script>

<div id="alert-box" class="popup" style="display:none; background:#fff; color:black; font-weight:bold; z-index:99999;"></div>
</body>
</html>
